snmad@LAPTOP-7AACOH9U MINGW64 /c/@calmcompiler/terraform_azure_fnapp/infrastructure
$ ./base_setup.sh
Name                    CloudName    SubscriptionId                        TenantId                              State    IsDefault
----------------------  -----------  ------------------------------------  ------------------------------------  -------  -----------
Concierge Subscription  AzureCloud   8b6001cd-a329-4999-8dbb-3b3261bb100a  604c1504-c6a3-4080-81aa-b33091104187  Enabled  False
calmcompiler            AzureCloud   3bf3e411-8098-44b9-b34f-73b2829eb2ad  6f753707-3acb-427a-8c54-ae9256022fbb  Enabled  True
{
  "id": "/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg",
  "location": "southindia",
  "managedBy": null,
  "name": "calmccrg",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}
A storage account with the provided name calmccsa is found. Will continue to update the existing account.
{
  "accessTier": "Hot",
  "accountMigrationInProgress": null,
  "allowBlobPublicAccess": false,
  "allowCrossTenantReplication": false,
  "allowSharedKeyAccess": null,
  "allowedCopyScope": null,
  "azureFilesIdentityBasedAuthentication": null,
  "blobRestoreStatus": null,
  "creationTime": "2025-11-27T11:56:21.997915+00:00",
  "customDomain": null,
  "defaultToOAuthAuthentication": null,
  "dnsEndpointType": null,
  "enableExtendedGroups": null,
  "enableHttpsTrafficOnly": true,
  "enableNfsV3": null,
  "encryption": {
    "encryptionIdentity": null,
    "keySource": "Microsoft.Storage",
    "keyVaultProperties": null,
    "requireInfrastructureEncryption": null,
    "services": {
      "blob": {
        "enabled": true,
        "keyType": "Account",
        "lastEnabledTime": "2025-11-27T11:56:22.075964+00:00"
      },
      "file": {
        "enabled": true,
        "keyType": "Account",
        "lastEnabledTime": "2025-11-27T11:56:22.075964+00:00"
      },
      "queue": null,
      "table": null
    }
  },
  "extendedLocation": null,
  "failoverInProgress": null,
  "geoReplicationStats": null,
  "id": "/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg/providers/Microsoft.Storage/storageAccounts/calmccsa",
  "identity": null,
  "immutableStorageWithVersioning": null,
  "isHnsEnabled": null,
  "isLocalUserEnabled": null,
  "isSftpEnabled": null,
  "isSkuConversionBlocked": null,
  "keyCreationTime": {
    "key1": "2025-11-27T11:56:22.075964+00:00",
    "key2": "2025-11-27T11:56:22.075964+00:00"
  },
  "keyPolicy": null,
  "kind": "StorageV2",
  "largeFileSharesState": null,
  "lastGeoFailoverTime": null,
  "location": "southindia",
  "minimumTlsVersion": "TLS1_0",
  "name": "calmccsa",
  "networkRuleSet": {
    "bypass": "AzureServices",
    "defaultAction": "Allow",
    "ipRules": [],
    "ipv6Rules": [],
    "resourceAccessRules": null,
    "virtualNetworkRules": []
  },
  "primaryEndpoints": {
    "blob": "https://calmccsa.blob.core.windows.net/",
    "dfs": "https://calmccsa.dfs.core.windows.net/",
    "file": "https://calmccsa.file.core.windows.net/",
    "internetEndpoints": null,
    "microsoftEndpoints": null,
    "queue": "https://calmccsa.queue.core.windows.net/",
    "table": "https://calmccsa.table.core.windows.net/",
    "web": "https://calmccsa.z30.web.core.windows.net/"
  },
  "primaryLocation": "southindia",
  "privateEndpointConnections": [],
  "provisioningState": "Succeeded",
  "publicNetworkAccess": null,
  "resourceGroup": "calmccrg",
  "routingPreference": null,
  "sasPolicy": null,
  "secondaryEndpoints": null,
  "secondaryLocation": null,
  "sku": {
    "name": "Standard_LRS",
    "tier": "Standard"
  },
  "statusOfPrimary": "available",
  "statusOfSecondary": null,
  "storageAccountSkuConversionStatus": null,
  "tags": {},
  "type": "Microsoft.Storage/storageAccounts"
}
{
  "created": false
}
{
  "created": false
}
{
  "asyncScalingEnabled": false,
  "elasticScaleEnabled": false,
  "extendedLocation": null,
  "freeOfferExpirationTime": "2026-01-06T05:24:19.273333",
  "geoRegion": "South India",
  "hostingEnvironmentProfile": null,
  "hyperV": false,
  "id": "/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg/providers/Microsoft.Web/serverfarms/calmccserviceplan",
  "isSpot": false,
  "isXenon": false,
  "kind": "linux",
  "kubeEnvironmentProfile": null,
  "location": "southindia",
  "maximumElasticWorkerCount": 1,
  "maximumNumberOfWorkers": 0,
  "name": "calmccserviceplan",
  "numberOfSites": 0,
  "numberOfWorkers": 1,
  "perSiteScaling": false,
  "provisioningState": "Succeeded",
  "reserved": true,
  "resourceGroup": "calmccrg",
  "sku": {
    "capabilities": null,
    "capacity": 1,
    "family": "B",
    "locations": null,
    "name": "B1",
    "size": "B1",
    "skuCapacity": null,
    "tier": "Basic"
  },
  "spotExpirationTime": null,
  "status": "Ready",
  "subscription": "3bf3e411-8098-44b9-b34f-73b2829eb2ad",
  "tags": null,
  "targetWorkerCount": 0,
  "targetWorkerSizeId": 0,
  "type": "Microsoft.Web/serverfarms",
  "workerTierName": null,
  "zoneRedundant": false
}

snmad@LAPTOP-7AACOH9U MINGW64 /c/@calmcompiler/terraform_azure_fnapp/infrastructure
$ terraform init
Initializing the backend...

Successfully configured the backend "azurerm"! Terraform will automatically
use this backend unless the backend configuration changes.
Initializing provider plugins...
- Finding latest version of hashicorp/random...
- Finding latest version of hashicorp/null...
- Finding latest version of hashicorp/azurerm...
- Installing hashicorp/random v3.7.2...
- Installed hashicorp/random v3.7.2 (signed by HashiCorp)
- Installing hashicorp/null v3.2.4...
- Installed hashicorp/null v3.2.4 (signed by HashiCorp)
- Installing hashicorp/azurerm v4.55.0...
- Installed hashicorp/azurerm v4.55.0 (signed by HashiCorp)
Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run "terraform init" in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

snmad@LAPTOP-7AACOH9U MINGW64 /c/@calmcompiler/terraform_azure_fnapp/infrastructure
$ terraform plan -out=tf_plan_01
Acquiring state lock. This may take a few moments...
null_resource.build_function: Refreshing state... [id=1572792597]
random_string.suffix: Refreshing state... [id=m7hnn]
data.azurerm_service_plan.plan: Reading...
data.azurerm_storage_account.sa: Reading...
data.azurerm_service_plan.plan: Read complete after 2s [id=/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg/providers/Microsoft.Web/serverFarms/calmccserviceplan]
data.azurerm_storage_account.sa: Read complete after 2s [id=/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg/providers/Microsoft.Storage/storageAccounts/calmccsa]
data.azurerm_storage_account_sas.sas: Reading...
azurerm_storage_blob.function_zip: Refreshing state... [id=https://calmccsa.blob.core.windows.net/calmccblobstore/function.zip]
data.azurerm_storage_account_sas.sas: Read complete after 0s [id=38695fa0de4310472afd67d7fbde8660e5499d7e93bafcfc4450919f99d9809b]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create
-/+ destroy and then create replacement

Terraform will perform the following actions:

  # azurerm_linux_function_app.func will be created
  + resource "azurerm_linux_function_app" "func" {
      + app_settings                                   = (known after apply)
      + builtin_logging_enabled                        = true
      + client_certificate_enabled                     = false
      + client_certificate_mode                        = "Optional"
      + content_share_force_disabled                   = false
      + custom_domain_verification_id                  = (sensitive value)
      + daily_memory_time_quota                        = 0
      + default_hostname                               = (known after apply)
      + enabled                                        = true
      + ftp_publish_basic_authentication_enabled       = true
      + functions_extension_version                    = "~4"
      + hosting_environment_id                         = (known after apply)
      + https_only                                     = false
      + id                                             = (known after apply)
      + key_vault_reference_identity_id                = (known after apply)
      + kind                                           = (known after apply)
      + location                                       = "southindia"
      + name                                           = "calmccfnappv3-m7hnn"
      + outbound_ip_address_list                       = (known after apply)
      + outbound_ip_addresses                          = (known after apply)
      + possible_outbound_ip_address_list              = (known after apply)
      + possible_outbound_ip_addresses                 = (known after apply)
      + public_network_access_enabled                  = true
      + resource_group_name                            = "calmccrg"
      + service_plan_id                                = "/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg/providers/Microsoft.Web/serverFarms/calmccserviceplan"
      + site_credential                                = (sensitive value)
      + storage_account_access_key                     = (sensitive value)
      + storage_account_name                           = "calmccsa"
      + storage_uses_managed_identity                  = false
      + virtual_network_backup_restore_enabled         = false
      + vnet_image_pull_enabled                        = false
      + webdeploy_publish_basic_authentication_enabled = true
      + zip_deploy_file                                = (known after apply)

      + identity {
          + principal_id = (known after apply)
          + tenant_id    = (known after apply)
          + type         = "SystemAssigned"
        }

      + site_config {
          + always_on                               = true
          + app_scale_limit                         = (known after apply)
          + container_registry_use_managed_identity = false
          + default_documents                       = (known after apply)
          + detailed_error_logging_enabled          = (known after apply)
          + elastic_instance_minimum                = (known after apply)
          + ftps_state                              = "Disabled"
          + http2_enabled                           = false
          + ip_restriction_default_action           = "Allow"
          + linux_fx_version                        = (known after apply)
          + load_balancing_mode                     = "LeastRequests"
          + managed_pipeline_mode                   = "Integrated"
          + minimum_tls_version                     = "1.2"
          + pre_warmed_instance_count               = (known after apply)
          + remote_debugging_enabled                = false
          + remote_debugging_version                = (known after apply)
          + scm_ip_restriction_default_action       = "Allow"
          + scm_minimum_tls_version                 = "1.2"
          + scm_type                                = (known after apply)
          + scm_use_main_ip_restriction             = false
          + use_32_bit_worker                       = false
          + vnet_route_all_enabled                  = false
          + websockets_enabled                      = false
          + worker_count                            = (known after apply)
        }
          + websockets_enabled                      = false
          + worker_count                            = (known after apply)
        }
    }

  # azurerm_storage_blob.function_zip must be replaced
-/+ resource "azurerm_storage_blob" "function_zip" {
      ~ access_tier            = "Hot" -> (known after apply)
      ~ id                     = "https://calmccsa.blob.core.windows.net/calmccblobstore/function.zip" -> (known after apply)
      ~ metadata               = {} -> (known after apply)
      ~ name                   = "function.zip" -> (known after apply) # forces replacement
      ~ url                    = "https://calmccsa.blob.core.windows.net/calmccblobstore/function.zip" -> (known after apply)
        # (10 unchanged attributes hidden)

To perform exactly these actions, run the following command to apply:
    terraform apply "tf_plan_01"
Releasing state lock. This may take a few moments...


snmad@LAPTOP-7AACOH9U MINGW64 /c/@calmcompiler/terraform_azure_fnapp/infrastructure
$ terraform apply "tf_plan_01"
Acquiring state lock. This may take a few moments...
azurerm_storage_blob.function_zip: Destroying... [id=https://calmccsa.blob.core.windows.net/calmccblobstore/function.zip]
azurerm_storage_blob.function_zip: Destruction complete after 2s
null_resource.build_function: Destroying... [id=1572792597]
null_resource.build_function: Destruction complete after 0s
null_resource.build_function: Creating...
null_resource.build_function: Provisioning with 'local-exec'...
null_resource.build_function (local-exec): Executing: ["bash" "-c" "      pushd azure-function-ts\r\n      chmod +x build.sh\r\n      ./build.sh\r\n      popd\r\n"]
null_resource.build_function (local-exec): /c/@calmcompiler/terraform_azure_fnapp/infrastructure/azure-function-ts /c/@calmcompiler/terraform_azure_fnapp/infrastructure
null_resource.build_function (local-exec): + rm -rf dist function.zip
null_resource.build_function (local-exec): + mkdir -p dist
null_resource.build_function (local-exec): + npm install

null_resource.build_function (local-exec): up to date, audited 9 packages in 1s

null_resource.build_function (local-exec): found 0 vulnerabilities
null_resource.build_function (local-exec): + npx tsc
null_resource.build_function (local-exec): + for func in hello*
null_resource.build_function (local-exec): + cp hello1/function.json dist/hello1/
null_resource.build_function (local-exec): + cp host.json dist/
null_resource.build_function (local-exec): + cp package.json dist/
null_resource.build_function (local-exec): + cd dist
null_resource.build_function (local-exec): + zip -r ../function.zip .
null_resource.build_function (local-exec):   adding: hello1/ (192 bytes security) (stored 0%)
null_resource.build_function (local-exec):   adding: hello1/function.json (172 bytes security) (deflated 50%)
null_resource.build_function (local-exec):   adding: hello1/index.js (172 bytes security) (deflated 30%)
null_resource.build_function (local-exec):   adding: host.json (172 bytes security) (deflated 29%)
null_resource.build_function (local-exec):   adding: package.json (172 bytes security) (deflated 41%)
null_resource.build_function (local-exec): + cd ..
null_resource.build_function (local-exec): + echo '⭐ function.zip created successfully!'
null_resource.build_function (local-exec): ⭐ function.zip created successfully!
null_resource.build_function (local-exec): + unzip -l function.zip
null_resource.build_function (local-exec): Archive:  function.zip
null_resource.build_function (local-exec):   Length      Date    Time    Name
null_resource.build_function (local-exec): ---------  ---------- -----   ----
null_resource.build_function (local-exec):         0  2025-12-07 11:09   hello1/
null_resource.build_function (local-exec):       299  2025-12-07 11:09   hello1/function.json
null_resource.build_function (local-exec):       268  2025-12-07 11:09   hello1/index.js
null_resource.build_function (local-exec):       143  2025-12-07 11:09   host.json
null_resource.build_function (local-exec):       307  2025-12-07 11:09   package.json
null_resource.build_function (local-exec): ---------                     -------
null_resource.build_function (local-exec):      1017                     5 files
null_resource.build_function (local-exec): /c/@calmcompiler/terraform_azure_fnapp/infrastructure
null_resource.build_function: Creation complete after 8s [id=1699219883]
azurerm_storage_blob.function_zip: Creating...
azurerm_storage_blob.function_zip: Creation complete after 1s [id=https://calmccsa.blob.core.windows.net/calmccblobstore/function_20251207_053839.zip]
azurerm_linux_function_app.func: Creating...
azurerm_linux_function_app.func: Still creating... [00m10s elapsed]
azurerm_linux_function_app.func: Still creating... [00m20s elapsed]
azurerm_linux_function_app.func: Still creating... [00m30s elapsed]
azurerm_linux_function_app.func: Still creating... [00m40s elapsed]
azurerm_linux_function_app.func: Still creating... [00m50s elapsed]
azurerm_linux_function_app.func: Still creating... [01m00s elapsed]
azurerm_linux_function_app.func: Still creating... [01m10s elapsed]
azurerm_linux_function_app.func: Creation complete after 1m13s [id=/subscriptions/3bf3e411-8098-44b9-b34f-73b2829eb2ad/resourceGroups/calmccrg/providers/Microsoft.Web/sites/calmccfnappv3-m7hnn]
Releasing state lock. This may take a few moments...

Apply complete! Resources: 3 added, 0 changed, 2 destroyed.

snmad@LAPTOP-7AACOH9U MINGW64 /c/@calmcompiler/terraform_azure_fnapp/infrastructure
$

